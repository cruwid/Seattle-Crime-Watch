<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>Day and Night</title>
    <script type="text/javascript" src="lib/d3.js"></script>
	<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
    
	<style type="text/css">
		div#day-length text {
  		fill: gray;
  		font-family: Helvetica, sans-serif;
  		font-size: 10px;
		}
		li
		{
		display:inline;
		padding-right:20px;
		}
	</style>
	<script type="text/javascript">
	$(document).ready(function ()
		{
		      var yearDropDown = $("#Year").val();
		      var crimeTypeDropDown = $("#incident").val();
		      var suburbDropDown = $("#suburbName").val();
			plotCrimes(yearDropDown,crimeTypeDropDown,suburbDropDown);
			
			 $("#suburbName").change(function()
			{
			      yearDropDown = $("#Year").val();
			      crimeTypeDropDown = $("#incident").val();
			      suburbDropDown = $("#suburbName").val();
				 plotCrimes(yearDropDown,crimeTypeDropDown,suburbDropDown);
			 });
			 
			 $("#incident").change(function()
			{
				yearDropDown = $("#Year").val();
				crimeTypeDropDown = $("#incident").val();
				suburbDropDown = $("#suburbName").val();
				plotCrimes(yearDropDown,crimeTypeDropDown,suburbDropDown);
			});
			 
			$("#Year").change(function()
			{
					yearDropDown = $("#Year").val();
					crimeTypeDropDown = $("#incident").val();
					suburbDropDown = $("#suburbName").val();
					plotCrimes(yearDropDown,crimeTypeDropDown,suburbDropDown);
			});
			   
		});

	function plotCrimes(year,crimeType,suburb)
	{
		var fetchSunData =[];
		var crimeData =[];
		$.getJSON("http://ec2-23-22-47-28.compute-1.amazonaws.com/Hello911/api/sunMovementData",
				  function (data) {
				      // On success, 'data' contains a list of sun movement data.
				     
				      $.each(data, function (key, val) {

				          // Format the text to display.
				          var parsebTwilight = val.bTwilight.split(":");
				          var parseSunrise = val.sunrise.split(":");
				          var parsesunTransit = val.sunTransit.split(":");
				          var parseSunset = val.sunset.split(":");
				          var parseeTwilight = val.eTwilight.split(":");
				          var str = {date:new Date(val.date), bTwilight: [parsebTwilight[0], parsebTwilight[1]], sunrise:[parseSunrise[0], parseSunrise[1]], sunTransit:[parsesunTransit[0], parsesunTransit[1]], sunset: [parseSunset[0], parseSunset[1]], eTwilight:[parseeTwilight[0], parseeTwilight[1]]};
				          fetchSunData.push(str);
				      	});

				  $.getJSON("http://ec2-23-22-47-28.compute-1.amazonaws.com/Hello911/api/crimePlot?year="+year+"&crimeType="+crimeType+"&Suburb="+suburb,
							  function (data) {
					  $.each(data, function (key, val) {
						  var parseTime = val.crimeTime.split(":");
						  var str = {Crime:val.crimeType, Date: new Date(val.crimeDate),Time:[parseTime[0],parseTime[1]] };
						  crimeData.push(str);
					  });

				dayNightViz(fetchSunData, crimeData, crimeType, suburb);
				  });			 
			});
	}
	
    </script>
    
  	</head>
  	<body>
<div id="filter">
	<div style="float:left; width:400px;height:50px">
	<h2>Yearly Crime Pattern Analyzer</h2>
	</div>
	
	<ul style="float:left;list-style:none;display:inline;white-space:nowrap" >
		<li>Year to Analyze:
			<select id="Year" >
				<option>2012</option>
			</select>
		</li>
		<li>Type of Incident:
			<select id="incident" >
				<option>ALL</option>
				<option>ASSAULTS</option>
				<option>AUTO THEFTS</option>
				<option>COMMERCIAL BURGLARIES</option>
				<option>GUN CALLS</option>
				<option>HOMICIDE</option>
				<option>LIQUOR VIOLATIONS</option>
				<option>NARCOTICS COMPLAINTS</option>
				<option>RESIDENTIAL BURGLARIES</option>
				<option>ROBBERY</option>
				<option>THEFT</option>
				<option>WEAPONS CALLS</option>
			</select>
		</li>
		<li>Suburb:
			<select id="suburbName" >
				<option>ALL</option>
				<option>Ballard</option>
				<option>Beacon Hill</option>
				<option>Belltown</option>
				<option>Broadview</option>
				<option>Capitol Hill</option>
				<option>Central District</option>
				<option>Delridge</option>
				<option>Edmonds</option>
				<option>First Hill</option>
				<option>Georgetown</option>
				<option>Green Lake</option>
				<option>Greenwood</option>
				<option>Haller Lake</option>
				<option>International District</option>
				<option>Lake City</option>
				<option>Leschi</option>
				<option>Madison Park</option>
				<option>Madison Valley</option>
				<option>Madrona</option>
				<option>Magnolia</option>
				<option>Maple Leaf</option>
				<option>Mount Baker</option>
				<option>North Park</option>
				<option>Northgate</option>
				<option>Phinney Ridge</option>
				<option>Queen Anne</option>
				<option>Rainier Valley</option>
				<option>Shoreline</option>
				<option>University District</option>
				<option>Wallingford</option>
				<option>West Seattle</option>
				<option>White Center</option>
				<option>Yesler Terrace</option>
			</select>
		</li>
	</ul>
	
	<hr style="clear:both">
	</div>

	<div id="day-length" ></div>

	<script type="text/javascript">



	    function dayNightViz(sunData, crimeData, crimeTypeValue, suburb)
	{
	var width = 900;
	var height = 450;
	var padding = 40;
	var paddingX = 40;
	var paddingY = 40;
	var lineGraphHeight = height / 3;
	var symbolSize = 7;
	var teethLength = 12;
	var yDisplacement = 6;

	var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];


	// color selections for curves and clickable box
	// var curveColor = ["Peru", "SteelBlue", "Violet", "Teal", "Orange", "Turquoise", "Khaki", "LightCoral", "Goldenrod", "IndianRed", "BurlyWood", "Pink", "RosyBrown",
  					  // "Chartreuse", "Chocolate", "Coral", "DarkMagenta", "Fuchsia", "Gainsboro", "GhostWhite", "Indigo", "LemonChiffon", "Lime", "Linen" ,"OliveDrab"];
  	
  	///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	
	var curveColor = ["DarkSlateBlue", "SteelBlue", "BlueViolet", "CornflowerBlue", "HotPink", "Violet", "Turquoise", "LightBlue", "Pink", "Moccasin", "RosyBrown"
  					  ,"BurlyWood", "Lime", "GreenYellow", "Gainsboro", "Green", "SeaGreen", "Olive", "Sienna", "DarkOrange" ,"OrangeRed", "DarkOrchid", "Blue", "MidnightBlue", ];
  	
	///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	
	
	//Fake monthly data  should be get from jason
	var monthCrime = [
		{ month: 0, monthName: "Jan", days: 31, crime: getRandomCrime(24)},
		{ month: 1, monthName: "Feb", days: 29, crime: getRandomCrime(24)},
		{ month: 2, monthName: "Mar", days: 31, crime: getRandomCrime(24)},
		{ month: 3, monthName: "Apr", days: 30, crime: getRandomCrime(24)},
		{ month: 4, monthName: "May", days: 31, crime: getRandomCrime(24)},
		{ month: 5, monthName: "Jun", days: 30, crime: getRandomCrime(24)},
		{ month: 6, monthName: "Jul", days: 31, crime: getRandomCrime(24)},
		{ month: 7, monthName: "Aug", days: 31, crime: getRandomCrime(24)},
		{ month: 8, monthName: "Sep", days: 30, crime: getRandomCrime(24)},
		{ month: 9, monthName: "Oct", days: 31, crime: getRandomCrime(24)},
		{ month: 10, monthName: "Nov", days: 30, crime: getRandomCrime(24)},
		{ month: 11, monthName: "Dec", days: 31, crime: getRandomCrime(24)},
	];
	
	// Fake hour data should be get from jason
	// [ { hour: 0, section: "0 - 1", crime: getRandomCrime()}, .....]
	var hourCrime = getRandomCrimeForHour();
	

//////////////////////////////////////////////////
	
	function getRandomCrimeForHour() {
		var data = new Array();
		for (var i = 0; i < 24; i++) {
			data.push({ hour: i, section: i + " am - " + (i + 1) + " pm", crime: getRandomCrime(12)});  ///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
			// console.log("test crime for hour" + data[i].section);
		}
		return data;
	}
	
	function getRandomCrime(d) {
		var monthCrime = new Array();
		for(var i = 0; i < d; i++) {
			monthCrime[i] = Math.round(Math.random() * 500);
		}
		return monthCrime;
	}
	
	function yAxisLabel(d) {
  		if (d == 12) { return "noon"; }
  		if (d < 12) { return d; }
  	return (d - 12);
	}

	// The labels along the x axis will be positioned on the 15th of the
	// month
	// 建立Map<month, data>
	function midMonthDates() {
  		return d3.range(0, 12).map(function(i) { return new Date(2012, i, 15) });
	}

	// The labels along the x axis will be positioned on the 1st of the
	// month
	function firstMonthDates() {
  		var data = new Array();
  		for (var i = 0; i < 12; i++) {
  			data.push(new Date(2012, i, 1));
  		}
  			data.push(new Date(2012, 11, 31));
  		// return d3.range(0, 13).map(function(i) { return new Date(2012, i, 1) });
  		return data; 
	}

	/////////////////////////////////////////////

	// start a SVG
	d3.select("#yearCrimeViz").remove();
	var dayLength = d3.select("#day-length").
  		append("svg:svg").
  		attr("width", width + paddingX * 2 +  lineGraphHeight * 2).
  		attr("height", height * 2 + paddingY * 2).
  		attr("id","yearCrimeViz");
	

	var xScale = d3.time.scale().domain([new Date(2012, 0, 1, 0, 0), new Date(2012, 0, 1, 23, 59)]).range([0, width]);//Date + time
	var yScale = d3.time.scale().domain([new Date(2012, 0, 1), new Date(2012, 11, 31)]).range([0, height]);//Date
	var xGradientScale = d3.time.scale().domain([new Date(2012, 0, 1, 0, 0), new Date(2012, 0, 1, 23, 59)]).range([0, 1]);//Date + time
	


/////////click group//////////
  	var clickGroup = dayLength.append("svg:g") ////
		.attr("transform", "translate("+ paddingX + ", " + paddingY + ")");
	
 ///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%		
	var intentMonth = new Array();
	var defaultMonth = 5;
	var defaultHour = 5;
	intentMonth.push(defaultMonth); // default
	var intentHour = new Array();
	intentHour.push(defaultHour); // default	
	
	var monthClickDemo = clickGroup.selectAll("rect.monthClickDemo").
								 	 data(monthCrime).enter().
								 	 append("rect").
								 	 attr("id", function(d, i) { return "monthClick" + i; }).
    	 						 	 attr("x", -30).
				  				 	 attr("y", function(d, i) {return yScale(new Date(2012, i, 1));}).
				   				 	 attr("rx", 5).
				  				 	 attr("ry", 5).
				   				 	 attr("width", width + 60).
			   	   				 	 attr("height", function(d, i) {return yScale(new Date (2012, i, d.days)) - yScale(new Date (2012, i, 0))}).
    							 	 attr("fill", function (d, i) { return curveColor[d.month];}).
  					   				 attr("fill-opacity", "0.5").
    							 	 attr("stroke", "white").
			   			 		 	 attr("stroke-width", "1px").
			   			 		 	 attr("stroke-opacity", "0.1").
									 transition().          
        		   					 delay(function(d, i) { return i * 50}).            
        		   					 duration(700).
        		   					 attr("x", -10).
				   				 	 attr("width", width + 20).
				   				 	 attr("fill-opacity", "0");
			       			
	var hourClickDemo = clickGroup.selectAll("rect.hourClickDemo").
								 	 data(hourCrime).enter().
								 	 append("rect").
								 	 attr("id", function(d, i) { return "hourClick" + i; }).
    	 						 	 attr("x", function(d, i) {return xScale(new Date(2012, 0, 1, i));}).
				  				 	 attr("y", -20).
				  				 	 attr("rx", 5).
				  				 	 attr("ry", 5).
				   				 	 attr("width", function(d, i) {return xScale(new Date(2012, 0, 1, 1)) - xScale(new Date(2012, 0, 1, 0))}).
			   	   				 	 attr("height", height + 40).
    							 	 attr("fill", function (d, i) { return curveColor[d.hour];}).
  					   				 attr("fill-opacity", "0.5").
    							 	 attr("stroke", "white").
			   			 		 	 attr("stroke-width", "1px").
			   			 		 	 attr("stroke-opacity", "0.5").
			   			 		 	 transition().          
        		   					 delay(function(d, i) { return i * 50}).            
        		   					 duration(700).
        		   					 attr("y", -10).
				   				 	 attr("height", height + 20).
				   				 	 attr("fill-opacity", "0");

	
	var clickLength = 20;
	
	var monthClick = clickGroup.selectAll("rect.monthClick").
								 	 data(monthCrime).enter().
								 	 append("rect").
								 	 attr("id", function(d, i) { return "monthClick" + i; }).
    	 						 	 attr("x", -clickLength).
				  				 	 attr("y", function(d, i) {return yScale(new Date(2012, i, 1));}).
				   				 	 attr("rx", 5).
				  				 	 attr("ry", 5).
				   				 	 attr("width", width + (2 * clickLength)).
			   	   				 	 attr("height", function(d, i) {return yScale(new Date (2012, i, d.days)) - yScale(new Date (2012, i, 0))}).
    							 	 attr("fill", function (d, i) { if(i == defaultMonth) {return curveColor[i];
    							 	 													 } else {return "white";}}).
  					   				 attr("fill-opacity", function (d, i) { if(i == defaultHour) {return 1;
  					   				 									  } else {return 0;}}).
    							 	 attr("stroke", "white").
			   			 		 	 attr("stroke-width", "1px").
			   			 		 	 attr("stroke-opacity", "0.1").
			   			 		 	 on("click", monthOnClick).
			   			 		 	 on("mouseover", monthOnHover).
			   			 		 	 on("mouseout", monthOnOut);	   	
			   			 		 	 
  	var hourClick = clickGroup.selectAll("rect.hourClick").
								 	 data(hourCrime).enter().
								 	 append("rect").
								 	 attr("id", function(d, i) { return "hourClick" + i; }).
    	 						 	 attr("x", function(d, i) {return xScale(new Date(2012, 0, 1, i));}).
				  				 	 attr("y", -clickLength).
				   				 	 attr("rx", 5).
				  				 	 attr("ry", 5).
				   				 	 attr("width", function(d, i) {return xScale(new Date(2012, 0, 1, 1)) - xScale(new Date(2012, 0, 1, 0))}).
			   	   				 	 attr("height", height + (2 * clickLength)).
			   	   				 	 // attr("fill", function (d, i) {return curveColor[i];}).
  					   				 // attr("fill-opacity", "1").
    							 	 attr("fill", function (d, i) { if(i == defaultHour) {return curveColor[i];
    							 	 													 } else {return "white";}}).
  					   				 attr("fill-opacity", function (d, i) { if(i == defaultHour) {return 1;
  					   				 									  } else {return 0;}}).
    							 	 attr("stroke", "white").
			   			 		 	 attr("stroke-width", "1px").
			   			 		 	 attr("stroke-opacity", "0.1").
			   			 		 	 on("click", hourOnClick).
			   			 		 	 on("mouseover", hourOnHover).
			   			 		 	 on("mouseout", hourOnOut);	    	 
  	
  	
 ///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	
  	
  	function monthOnHover(d) {
  		if (intentMonth.lastIndexOf(d.month) == -1) {
  			d3.select(this).attr("fill", function(d) {return curveColor[d.month]; })
  					   .attr("fill-opacity", "1");	
  		}else {
  			d3.select(this).attr("fill", function(d) {return curveColor[d.month ]; })
  				       	   .attr("fill-opacity", "0.5");
  		}
  	}
  	
  	function monthOnOut(d) {
  		if (intentMonth.lastIndexOf(d.month) == -1) {
  			d3.select(this).attr("fill", "white")
  					   .attr("fill-opacity", "0");	
  		}else {
  			d3.select(this).attr("fill", function(d) {return curveColor[d.month]; })
  				       	   .attr("fill-opacity", "1");
  		}
  	}
  	
  	function monthOnClick(d) {
  		
  		// select 
  		if(intentMonth.lastIndexOf(d.month) == -1) {
  			intentMonth.push(d.month);
  			d3.select(this).attr("fill", function(d) {return curveColor[d.month]; })
  				       	   .attr("fill-opacity", "1");
  		} else {
  			intenMonth = remove(intentMonth, d.month);
  			d3.select(this).attr("fill", "white")
  					   	   .attr("fill-opacity", "0");
  		} 

  		d3.select("#monthGroup").remove();
  		drawMonthCurves(intentMonth);
  	}
  	
  	function hourOnHover(d) {
  		if (intentHour.lastIndexOf(d.hour) == -1) {
  			d3.select(this).attr("fill", function(d) {return curveColor[d.hour]; })
  					   .attr("fill-opacity", "1");	
  		}else {
  			d3.select(this).attr("fill", function(d) {return curveColor[d.hour]; })
  				       	   .attr("fill-opacity", "0.5");
  		}
  	}
  	
  	function hourOnOut(d) {
  		if (intentHour.lastIndexOf(d.hour) == -1) {
  			d3.select(this).attr("fill", "white")
  					   .attr("fill-opacity", "0");	
  		}else {
  			d3.select(this).attr("fill", function(d) {return curveColor[d.hour]; })
  				       	   .attr("fill-opacity", "1");
  		}
  	}
  	
  	function hourOnClick(d) {
  		
  		if(intentHour.lastIndexOf(d.hour) == -1) {
  			intentHour.push(d.hour);
  			
  			d3.select(this).attr("fill", function(d) {return curveColor[d.hour]; })
  				       	   .attr("fill-opacity", "1");
  		} else {
  			console.log("remove");
  			intenHour = remove(intentHour, d.hour);
  			d3.select(this).attr("fill", "white")
  					   	   .attr("fill-opacity", "0");
  		} 

  		d3.select("#hourGroup").remove();
  		drawHourCurves(intentHour);
  	}
  	
  	
  	function remove (array, element) {
	var index =  array.lastIndexOf(element);
	array.splice(index, 1);
	return array;
}
  	
///////////////////////////////////////////////////////////////////





	// create a group to hold the axis-related elements
	var axisGroup = dayLength.append("svg:g").
  	attr("transform", "translate("+paddingX+","+paddingY+")");

	// draw the x and y tick marks. Since they are behind the visualization, they
	// can be drawn all the way across it. Because the <g> has been
	// translated, they stick out the left side by going negative.

	///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	
	// Title
	axisGroup.append("svg:text").
	attr("id", "title1").
  	text("Change in Crimes with daylight ").
  	attr("x", width / 2).
  	attr("y", -25).
  	// attr("dy", yDisplacement).
  	style("font-family", "sans-serif").
	style("font-size", "15px").
  	style("text-anchor", "middle");
  	// attr("class", "axis yAxisLeft"); 
	 
	///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	
	
	
	// y axis 左右刻度
	axisGroup.selectAll(".yTicks").
 	data(firstMonthDates).
 	enter().append("svg:line").
  	attr("x1", -5).
  	attr("y1", yScale).
  	attr("x2", width + 5).
  	attr("y2", yScale).
  	attr("stroke", "lightgray").
  	attr("class", "yTicks");


	// draw the text for the labels. Since it is the same on top and
	// bottom, there is probably a cleaner way to do this by copying the
	// result and translating it to the opposite side

	//左label 
	axisGroup.selectAll("text.yAxisLeft").
  	data(midMonthDates).
  	enter().
  	append("svg:text").
  	text(function(d, i) { return monthNames[i]; }).
  	attr("x", -15).
  	attr("y", yScale).
  	attr("dy", yDisplacement).
  	attr("text-anchor", "end").
  	attr("class", "axis yAxisLeft");

	//右label 
	axisGroup.selectAll("text.yAxisRight").
  	data(midMonthDates).
  	enter().
  	append("svg:text").
  	text(function(d, i) { return monthNames[i]; }).
  	attr("x", width + 15).
  	attr("y", yScale).
  	attr("dy", yDisplacement).
  	attr("text-anchor", "start").
  	attr("class", "yAxisRight");


	// x axis 上下刻度
	axisGroup.selectAll(".xTicks").
  	data(d3.range(0,25)).
  	enter().append("svg:line").
  	// Round and add 0.5 to fix anti-aliasing effects (see above)
  	attr("x1", function(d) { return xScale(new Date(2012, 0, 1, d)); }).
  	attr("y1", -3).
  	attr("x2", function(d) { return xScale(new Date(2012, 0, 1, d)); }).
  	attr("y2", height + 3).
  	attr("stroke", "lightgray").
  	attr("class", "xTicks");

	//上label
	axisGroup.selectAll("text.xAxisTop").
  	data(d3.range(0, 25)).
  	enter().
  	append("svg:text").
  	text(yAxisLabel).
  	attr("y", -7).
  	attr("x", function(d) { return xScale(new Date(2012, 0, 1, d)); }).
  	attr("class", "xAxisTop").
  	attr("text-anchor", "middle");

	//下label
	axisGroup.selectAll("text.xAxisBottom").
  	data(d3.range(0, 25)).
  	enter().
  	append("svg:text").
  	text(yAxisLabel).
  	attr("y", height + 15).
  	attr("x", function(d) { return xScale(new Date(2012, 0, 1, d)); }).
  	attr("class", "xAxisBottom").
  	attr("text-anchor", "middle");
  

	// create a group for the sunrise and sunset paths
	var lineGroup = dayLength.append("svg:g").
  	attr("transform", "translate("+ paddingX + ", " + paddingY + ")");

	// draw the background. The part of this that remains uncovered will
	// represent the daylight hours.

	// Background
	lineGroup.append("svg:rect").
  	attr("x", 0).
  	attr("y", 0).
  	attr("height", height).
  	attr("width", width).
  	attr("fill", "lightblue");

	// The meat of the visualization is surprisingly simple. sunriseLine
	// and sunsetLine are areas (closed svg:path elements) that use the date
	// for the x coordinate and sunrise and sunset (respectively) for the y
	// coordinate. The sunrise shape is anchored at the top of the chart, and
	// sunset area is anchored at the bottom of the chart.

	// Sunrise
	var sunriseLine = d3.svg.area().
  					  y(function(d) { return yScale(d.date); }).
  					  x0(0).
  					  x1(function(d) { return xScale(new Date(2012, 0, 1, d.sunrise[0], d.sunrise[1])); }).
  					  interpolate("linear");

	lineGroup.append("svg:path").
  	attr("d", sunriseLine(sunData)).
  	attr("fill", "steelblue");

	
	// Sunset
	var sunsetLine = d3.svg.area().
  					 x0(width).
  					 x1(function(d) { return xScale(new Date(2012, 0, 1, d.sunset[0], d.sunset[1])); }).
  					 y(function(d) { return yScale(d.date); }).
  					 interpolate("linear");

	lineGroup.append("svg:path").
  	attr("d", sunsetLine(sunData)).
 	attr("fill", "steelblue"); 
 	
 	
	// Noon Line
	lineGroup.append("svg:line").
  	attr("y1", 0).
  	attr("x1", d3.round(xScale(new Date(2012, 0, 1, 12))) + 0.5).
  	attr("y2", height).
  	attr("x2", d3.round(xScale(new Date(2012, 0, 1, 12))) + 0.5).
  	attr("stroke", "white");
  	
 	
 
 	
 	
 	// create a group for the sunrise and sunset background color
 	var gradientBackgroundGroup = dayLength.append("svg:g") ////
		.attr("transform", "translate("+ paddingX + ", " + paddingY + ")");
							
	console.log("test gradient" + xGradientScale(new Date(2012,0,1,23,59)));
							
	// color gradient for loop							
  	var defs = gradientBackgroundGroup.append("svg:defs")
	.selectAll(".gradient")
	.data(d3.range(0,sunData.length)).enter()	///
  	.append("svg:linearGradient")
  	// .attr('gradientUnits', 'userSpaceOnUse')
    .attr("id", function(d, i) { return "gradient" + i; })
    .attr("x1", "0%")
    .attr("y1", "0%")
    .attr("x2", "100%")
    .attr("y2", "0%")
	.selectAll("stop")
    .data(getData)
    .enter()
    .append("stop")
    .attr("offset", function(d) { return d.offset; })
    .attr("stop-color", function(d) { return d.color; });    
	
	// get the color gradient map by given day
	function getData(d) {
		return getGradientData(sunData[d]) ;
	}


// {date: new Date(2012, 1, 21), bTwilight: [6, 33], sunrise: [7, 04], sunTransit: [12, 23], sunset: [17, 43], eTwilight: [18, 14]},

	// get the color gradient map by given day and night info array
	function getGradientData(d) {
		// console.log("time2per: %d : %d", d.bTwilight[0], d.bTwilight[1]);
		var gradientData = [];
		gradientData.push({offset: 0, color: "rgba(76,88,152,0.5)"}); // dark night
		// night blue to dark blue
		gradientData.push({offset: xGradientScale(new Date(2012, 0, 1, d.bTwilight[0], d.bTwilight[1])), color: "#37538C"}); //start twilight
		// darkblue to orange
		gradientData.push({offset: xGradientScale(new Date(2012, 0, 1, d.sunrise[0], d.sunrise[1])), color: "#FF9B0D"}); //start sunrise
		// orange to yellow (15 min)
		gradientData.push({offset: xGradientScale(new Date(2012, 0, 1, d.sunrise[0], d.sunrise[1])) + 0.01, color: "#FFED00"}); //sun rising
		// yellow to light blue (30 min)
		gradientData.push({offset: xGradientScale(new Date(2012, 0, 1, d.sunrise[0], d.sunrise[1])) + 0.03, color: "#ADD5F7"}); //sunrise over
		// light blue to white
		gradientData.push({offset: xGradientScale(new Date(2012, 0, 1, d.sunTransit[0], d.sunTransit[1])), color: "white"}); //sun transit
		// white to white
		gradientData.push({offset: xGradientScale(new Date(2012, 0, 1, d.sunset[0], d.sunset[1])) - 0.03, color: "white"}); //start sunset
		// white to yellow
		gradientData.push({offset: xGradientScale(new Date(2012, 0, 1, d.sunset[0], d.sunset[1])), color: "#FFED00"}); //start sunset
		// white to red
		gradientData.push({offset: xGradientScale(new Date(2012, 0, 1, d.eTwilight[0], d.eTwilight[1])), color: "#FF9B0D"}); //sunset over
		// red to dark blue
		gradientData.push({offset: xGradientScale(new Date(2012, 0, 1, d.eTwilight[0], d.eTwilight[1])) + 0.01, color: "#37538C"}); //sunset over
		// dark blue to night blue
		gradientData.push({offset: 1, color: "rgba(76,88,152,0.5)"}); // dark night
		return gradientData;
	}

	// draw the gradient background
	var rect = gradientBackgroundGroup.selectAll("rect").
				   data(sunData).
				   enter().
				   append("rect").
				   attr("x", 0).
				   attr("y", function(d, i) {return yScale(d.date);}).
				   attr("width", width).
			   	   attr("height", function(d, i) {return yScale(new Date (2012, 0, 3)) - yScale(new Date (2012, 0, 1))}).
			       attr("fill", function(d, i) {return "url(#gradient" + i + ")";});
  	
  	// create a group for crime plot
  	var plotGroup = dayLength.append("svg:g").
  	attr("transform", "translate("+ paddingX + ", " + paddingY + ")");
  	
  	  	
  	// Plot Symbols
  	plotGroup.selectAll("path").
  		 	  data(crimeData).
  			  enter().
  			  append("svg:path").
    		  attr("d", d3.svg.symbol().
    		  type("dot").
    		  size(symbolSize)).
        	  attr("transform", time2Position).
    		  attr("stroke", "darkred").
    		  attr("stroke-width", "0.5px").
    		  attr("fill", "darkred").
    		  attr("opacity","0.5"); 	

  	function time2Position(d) {
  		return "translate(" + xScale(new Date(2012, 0, 1, d.Time[0], d.Time[1])) + "," + yScale(d.Date) + ")";
  	}
  	
  	
  	// Type: circle, cross, diamond, square, triangle-down, triangle-up
  	
  	// Return Type by Crime type
  	function crimeType(d) {
  		switch(d.Crime) {
  			case "shooting":
				return "dot";
				break;
			case "robbery":
				return "cross";
				break;
  		}
  	}
  	
  	// Return Color by Crime type
  	function crimeColor(d) {
  		switch(d.Crime) {
  			case "shooting":
				return "red";
				break;
			case "robbery":
				return "yellow";
				break;
  		}
  	}
  	
  	
  	
	
	
	
	/////////////////  Variables & Scales /////////////////
	var maxMonthlyCrime = d3.max(monthCrime, function(d) { return d3.max(d.crime); });
	var maxHourCrime = d3.max(hourCrime, function(d) { return d3.max(d.crime); });
	
	// console.log("testmaxHourCrime=" + maxHourCrime);
	
	// Max lable value
  	var maxMonthYaxisValue = getMaxLabelValue(maxMonthlyCrime);
  	var maxHourXaxisValue = getMaxLabelValue(maxHourCrime);
	
	// Scale factor
	var monthLineYscale = d3.scale.linear().domain([0, maxMonthlyCrime]).range([0, lineGraphHeight]);
   	var hourLineXscale = d3.scale.linear().domain([0, maxHourCrime]).range([0, lineGraphHeight]);
	
	console.log("read monthHourCrime, month= %d, crime= %d, max= %d", monthCrime[0].month, monthCrime[0].crime[11], maxMonthlyCrime);

	// get Maximum quantity of Y-Axis
  	// If the maximum values of crime is 569
  	// returns 600
  	function getMaxLabelValue(d) {
  		var temp = d;
  		var countDigit = 0;
  		var ceiling = 1;
  		
  		while(temp >= 10) {
  			temp = temp / 10;
  			countDigit++;
  		}

  		for(var j = 1; j <= (temp % 10); j++) {
  			ceiling++;
  		}
  		return ceiling * Math.pow(10, countDigit);
  	}
  	
  	console.log("read monthHourCrime ceiling %d", getMaxLabelValue(maxMonthlyCrime));
	
	
	
	
	
	////////Bottom Curve Graph
	///////////////////////////////////
	var monthPaddingX = paddingX;
	var monthPaddingY = paddingY + height + 30;
	
	// create a group to hold the axis-related elements of bottom graph
	var axismonthCurveGroup = dayLength.append("svg:g").
  	attr("transform", "translate("+monthPaddingX+","+monthPaddingY+")");  	
  	
  	///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	
	// Title
	axismonthCurveGroup.append("svg:text").
	attr("id", "titleBotom").
  	text("Monthly Crimes").
  	attr("x", width / 2).
  	attr("y", lineGraphHeight + 40).
  	// attr("dy", yDisplacement).
  	style("font-family", "sans-serif").
	style("font-size", "15px").
  	style("text-anchor", "middle");
  	// attr("class", "axis yAxisLeft"); 
	 
	///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	
  	
  	
  	
  	// x axis 上下刻度
	axismonthCurveGroup.selectAll(".xTicks").
  	data(d3.range(0,25)).
  	enter().append("svg:line").
  	// Round and add 0.5 to fix anti-aliasing effects (see above)
  	attr("x1", function(d) { return xScale(new Date(2012, 0, 1, d)); }).
  	attr("y1", -3).
  	attr("x2", function(d) { return xScale(new Date(2012, 0, 1, d)); }).
  	attr("y2", lineGraphHeight + 3).
  	attr("stroke", "lightgray").
  	attr("class", "xTicks");
  	
  	//下label
	axismonthCurveGroup.selectAll("text.xAxisBottom").
  	data(d3.range(0, 25)).
  	enter().
  	append("svg:text").
  	text(yAxisLabel).
  	attr("y", lineGraphHeight + 15).
  	attr("x", function(d) { return xScale(new Date(2012, 0, 1, d)); }).
  	attr("class", "xAxisBottom").
  	attr("text-anchor", "middle");
  	
  	// y axis 左右刻度
	axismonthCurveGroup.selectAll(".yTicks").
 	data(d3.range(0,11)).
 	enter().append("svg:line").
  	attr("x1", -5).
  	attr("y1", function(d) { return d * lineGraphHeight / 10}).
  	attr("x2", width + 5).
  	attr("y2", function(d) { return d * lineGraphHeight / 10}).
  	attr("stroke", "lightgray").
  	attr("class", "yTicks");
  	
  	
  	//左label 
	axismonthCurveGroup.selectAll("text.yAxisLeft").
  	data(d3.range(0, 1.1 * maxMonthYaxisValue , maxMonthYaxisValue / 10)).
  	enter().
  	append("svg:text").
  	text(function(d, i) { return d; }).
  	attr("x", -15).
  	attr("y", function(d, i) { return lineGraphHeight - i * lineGraphHeight / 10}).
  	attr("dy", yDisplacement).
  	attr("text-anchor", "end").
  	attr("class", "axis yAxisLeft");

	//右label 
	axismonthCurveGroup.selectAll("text.yAxisRight").
  	data(d3.range(0, 1.1 * maxMonthYaxisValue , maxMonthYaxisValue / 10)).
  	enter().
  	append("svg:text").
  	text(function(d, i) { return d; }).
  	attr("x", width + 15).
  	attr("y", function(d, i) { return lineGraphHeight - i * lineGraphHeight / 10}).
  	attr("dy", yDisplacement).
  	attr("text-anchor", "start").
  	attr("class", "yAxisRight");
  	
  	// opaque rect for decoration
  	axismonthCurveGroup.append("svg:rect").
  	attr("x", 0).
  	attr("y", 0).
  	attr("width", width).
    attr("height", lineGraphHeight).
    attr("fill", "white").
    attr("fill-opacity", "0.8");
  	
  
  	/////////////////////////////////////////////////
  	// create a group to draw curve elements of bottom graph
  	
	// var monthCurveGroup = dayLength.append("svg:g").
	// attr("id", "monthGroup").
  	// attr("transform", "translate("+ monthPaddingX +","+ monthPaddingY +")");  	
//   	
  	// From filter about what month should be draws.
  	// 2 means Feb
  	// var intentMonth = [2, 3, 4, 6, 12];
  	
  	function remove (array, element) {
		var index =  array.lastIndexOf(element);
		array.splice(index, 1);
		// console.log(array.toString());
		return array;
	}
 
  	
  	// input: [2, 4, .....], 1 means January
  	// return: [
	// { month: "Feb", crime: [.....]},
	// { month: "Apr", crime: [.....]}, ]	
  	function monthDrawData(d) {
  		var data = d.sort();
  		// console.log("test sort" + data[1]);
  		var result = [];
  		for (var i = 0; i < data.length; i++) {
  			result.push(monthCrime[data[i]
  				]);
  			// console.log("result: " +  result[i].monthName);
  		}
  		return result;
  	}
  	
  	// var curveColor = ["Peru", "SteelBlue", "Violet", "Pink", "Orange", "Maroon", "LightSkyBlue", "LightCoral", "Khaki", "Lavender", "BurlyWood", "Azure", "plum",
  					  // "Chartreuse", "Chocolate", "Coral", "DarkMagenta", "Fuchsia", "Gainsboro", "GhostWhite", "Indigo", "LemonChiffon", "Lime", "Linen" ,"OliveDrab"];
//   	
  	///////////call by filter
  	drawMonthCurves(intentMonth); 
  	///////////call by filter
  	
  	// input intentMonth;
  	function drawMonthCurves(d) {
  	
  	var monthCurveGroup = dayLength.append("svg:g").
	attr("id", "monthGroup").
  	attr("transform", "translate("+ monthPaddingX +","+ monthPaddingY +")"); 
  	
  	
  		for(var i = 0; i < monthDrawData(d).length; i++) {
		
			
			var monthCurveName = monthCurveGroup.append("svg:text").
    			text(monthDrawData(intentMonth)[i].monthName).
    			attr("x", xScale(new Date(2012, 0, 1, i , 30))).
				attr("y", lineGraphHeight - monthLineYscale(monthDrawData(intentMonth)[i].crime[i])).
				style("font-size", "8px").
				style("fill", curveColor[monthDrawData(intentMonth)[i].month]).
  				style("text-anchor", "middle").
  				attr("dy", 20);
		
		
		
			var line = d3.svg.line().
            			  x( function(d, i)  { return xScale(new Date(2012, 0, 1, i, 30)); }).
            		 	  y( function(d) { return lineGraphHeight - monthLineYscale(d); }).   ///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
            			  interpolate("linear");

			console.log("i= " + i);
			console.log("value" + monthDrawData(intentMonth)[i].month);

			monthCurveGroup.append("svg:path").
            				attr("d", line(monthDrawData(intentMonth)[i].crime)).
            				attr("fill", "none").
            				attr("stroke", curveColor[monthDrawData(intentMonth)[i].month]).
    						attr("stroke-width", "1px");
            				// .attr('class', 'x[0].crime');
       
			monthCurveGroup.selectAll("circle.dot").
          					data(monthDrawData(intentMonth)[i].crime).
          					enter().
          					append("svg:circle").
            				// .attr("class", "grand_central")
            				attr("cx", function(d, i) { return xScale(new Date(2012, 0, 1, i, 30));}).
            				attr("cy", function(d) { return lineGraphHeight - monthLineYscale(d);}).   ///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
            				attr("r", 3). 
            				attr("fill", curveColor[monthDrawData(intentMonth)[i].month]).
            				attr("stroke", "black").
            				attr("stroke-width", "0.5px").
            				on("mouseover", showMonthDetail).   ///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
            				on("mouseout", closeMonthDetail);   ///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
     	 }  
    }
  					   
	
  	function closeMonthDetail() {
    	d3.select(detailMonthGroup).remove();
    }
    
    function showMonthDetail(d, i) {
    	console.log("here d:" + d + "scale: "  );
    	var detailMonthGroup = dayLength.append("svg:g").
						attr("id", "detailMonthGroup").
  						attr("transform", "translate("+ monthPaddingX +","+ monthPaddingY +")"); 
        						
     detailMonthGroup.append("svg:text").
    			text(d + " crimes").
    			attr("x", xScale(new Date(2012, 0, 1, i, 30))).
				attr("y", lineGraphHeight - monthLineYscale(d)).
  				attr("text-anchor", "middle").
  				attr("dy", -10);

    }
  	
///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
  	
  	
  	////////////Right Curve Graph
  	///////////////////////////////////
  	var hourPaddingX = paddingX + width + 50;
	var hourPaddingY = paddingY;
	
	// create a group to hold the axis-related elements of bottom graph
	var axisHourCurveGroup = dayLength.append("svg:g").
  	attr("transform", "translate(" + hourPaddingX + "," + hourPaddingY + ")");  	
  	
  	///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	
	// Title
	axisHourCurveGroup.append("svg:text").
	attr("id", "titleRight").
  	text("Hourly Crimes").
  	attr("x", lineGraphHeight / 2).
  	attr("y", -25).
  	// attr("dy", yDisplacement).
  	style("font-family", "sans-serif").
	style("font-size", "15px").
  	style("text-anchor", "middle");
  	// attr("class", "axis yAxisLeft"); 
	 
	///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	
  	
  	// x axis 上下刻度
	axisHourCurveGroup.selectAll(".xTicks").
  	data(d3.range(0, 11)).
  	enter().append("svg:line").
  	// Round and add 0.5 to fix anti-aliasing effects (see above)
  	attr("x1", function(d) { return d * lineGraphHeight / 10}).
  	attr("y1", -3).
  	attr("x2", function(d) { return d * lineGraphHeight / 10}).
  	attr("y2", height + 3).
  	attr("stroke", "lightgray").
  	attr("class", "xTicks");
  	
  	//上label
	axisHourCurveGroup.selectAll("text.xAxisTop").
  	data(d3.range(0, 1.1 * maxHourXaxisValue , maxHourXaxisValue / 5)).
  	enter().
  	append("svg:text").
  	text(function(d, i) { return d; }).
  	attr("y", -7).
  	attr("x", function(d, i) { return i * 2 * lineGraphHeight / 10}).
  	attr("class", "xAxisTop").
  	attr("text-anchor", "middle");
  	
 	//下label
	axisHourCurveGroup.selectAll("text.xAxisBottom").
  	data(d3.range(0, 1.1 * maxHourXaxisValue , maxHourXaxisValue / 5)).
  	enter().
  	append("svg:text").
  	text(function(d, i) { return d; }).
  	attr("y", height + 15).
  	attr("x", function(d, i) { return i * 2 * lineGraphHeight / 10}).
  	attr("class", "xAxisBottom").
  	attr("text-anchor", "middle");
  	
  	// y axis 左右刻度
	axisHourCurveGroup.selectAll(".yTickss").
 	data(firstMonthDates).
 	enter().append("svg:line").
  	attr("x1", -5).
  	attr("y1", yScale).
  	attr("x2", lineGraphHeight + 5).
  	attr("y2", yScale).
  	attr("stroke", "lightgray").
  	attr("class", "yTicks");
  	
  	//右label 
	axisHourCurveGroup.selectAll("text.yAxisRight").
  	data(midMonthDates).
  	enter().
  	append("svg:text").
  	text(function(d, i) { return monthNames[i]; }).
  	attr("x", lineGraphHeight + 15).
  	attr("y", yScale).
  	attr("dy", yDisplacement).
  	attr("text-anchor", "start").
  	attr("class", "yAxisRight");
  	
  	
  	axisHourCurveGroup.append("svg:rect").
  	attr("x", 0).
  	attr("y", 0).
  	attr("width", lineGraphHeight).
    attr("height", height).
    attr("fill", "white").
    attr("fill-opacity", "0.8");
  	
  	
  	/////////////////////////////////////////////////
  	// create a group to draw curve elements of right graph
  	
	// var hourCurveGroup = dayLength.append("svg:g").
  	// attr("transform", "translate("+ hourPaddingX +","+ hourPaddingY +")");  	
  	
  	// From filter about what month should be draws.
  	// 2 means Feb
  	// var intentHour = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 ,16, 17, 18, 19, 20, 21, 22, 23];
  	
  	
  	// input: [2, 4, .....], 1 means hour section 1 - 2
  	// return: [
	// { section: 1, crime: [.....]},
	// { section: 2, crime: [.....]}, ]	
  	function hourDrawData(d) {
  		var data = d.sort();
  		var result = [];
  		for (var i = 0; i < data.length; i++) {
  			result.push(hourCrime[data[i]]);
  		}
  		return result;
  	}
  	 	
  	///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	
  	///////////call by filter
  	drawHourCurves(intentHour); 
  	///////////call by filter
  	
  	// input intentMonth;
  	function drawHourCurves(d) {

		console.log("drawdata length" + hourDrawData(d).length);

		var hourCurveGroup = dayLength.append("svg:g").
						attr("id", "hourGroup").
  						attr("transform", "translate("+ hourPaddingX +","+ hourPaddingY +")"); 

  		for(var i = 0; i < hourDrawData(d).length; i++) {

			console.log("test label" + getSection(hourDrawData(intentHour)[i].hour));
			
			var hourCurveName = hourCurveGroup.append("svg:text").
    			text(getSection(hourDrawData(intentHour)[i].hour)).
    			attr("x", hourLineXscale(hourDrawData(intentHour)[i].crime[i % 12])).
				attr("y", yScale(new Date(2012, (i % 12), 15))).
				style("font-size", "8px").
				style("fill", curveColor[hourDrawData(intentHour)[i].hour]).
  				style("text-anchor", "middle").
  				attr("dy", 20);

			
			// console.log("test draw hour: " +  i);
			var line = d3.svg.line().
            			  x( function(d) { return hourLineXscale(d); }).
            		 	  y( function(d, i) { return yScale(new Date(2012, i, 15)); }).
            			  interpolate("linear");


			hourCurveGroup.append("svg:path").
            				attr("d", line(hourDrawData(intentHour)[i].crime)).
            				attr("fill", "none").
            				attr("stroke", curveColor[hourDrawData(intentHour)[i].hour]).
    						attr("stroke-width", "1px");
            				// .attr('class', 'x[0].crime');
       
			hourCurveGroup.selectAll("circle.dot").
          					data(hourDrawData(intentHour)[i].crime).
          					enter().
          					append("svg:circle").
            				// .attr("class", "grand_central")
            				attr("cx", function(d) { return hourLineXscale(d); }).
            				attr("cy", function(d, i) { return yScale(new Date(2012, i, 15));}).
            				attr("r", 3).
            				attr("fill", curveColor[hourDrawData(intentHour)[i].hour]).
            				attr("stroke", "black").
            				attr("stroke-width", "0.5px").
            				on("mouseover", showHourDetail).  ///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
            				on("mouseout", closeHourDetail);  ///////////%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
            				
     	 }  
    }
  
   	
   	function getSection(d) {
   		if (d < 11) {
   			return d + " am - " + (d + 1) + " am";
   		} else if (d == 11) {
   			return d + " am - " + (d + 1) + " pm";
   		} else if (d == 23) {
   			return (d - 12) + " pm - " + 0 + " am";
   		} else if (d == 12) {
   			return d + " pm - " + ((d - 12) + 1) + " pm";
   		} 
   		else {
   			return (d - 12) + " pm - " + ((d - 12) + 1) + " pm";
   		}
   	}
   
    function closeHourDetail() {
    	d3.select(detailHourGroup).remove();
    }
    
    function showHourDetail(d, i) {
    	console.log("here d:" + d + "scale: "  );
    	
    	var detailHourGroup = dayLength.append("svg:g").
						attr("id", "detailHourGroup").
  						attr("transform", "translate("+ hourPaddingX +","+ hourPaddingY +")"); 
        					 						
     	detailHourGroup.append("svg:text").
    			text(d + " crimes").
    			attr("x", hourLineXscale(d)).
				attr("y", yScale(new Date(2012, i, 15))).
  				style("text-anchor", "middle").
  				attr("dy", -10);
  									 
  														 
  		
		console.log("text");
    }
    
    
    
    ///total crimes
    var totalCrimeGroup = dayLength.append("svg:g").
						attr("id", "totalCrimeGroup").
  						attr("transform", "translate("+ hourPaddingX +","+ monthPaddingY +")"); 

    
    totalCrimeGroup.append("svg:text").
    			text(" In 2012 ").
    			attr("x", lineGraphHeight / 2).
				attr("y", lineGraphHeight / 2).
  				style("text-anchor", "middle").
  				style("font-size", "16px").
  				// style("fill", "black").
  				attr("dy", -45).
  				attr("dx", 10);
  				
  	var totalCrimes =  totalCrimeGroup.append("svg:text").
    			text(crimeData.length).
    			attr("x", lineGraphHeight / 2).
				attr("y", lineGraphHeight / 2).
  				style("text-anchor", "middle").
  				style("font-size", "40px").
  				style("fill", "black").
  				attr("dy", 0).
  				attr("dx", 10);
    
    function getTotalCrimes(d) {
    	var result = 0;
    	for(var i = 0; i < monthCrime.length; i++) {
    		for(var j = 0; j < d[i].crime.length; j++) {
    				result = result + d[i].crime[j];
    		}
    	}
    	return result;
    }





    totalCrimeGroup.append("svg:text").

    			text(function () { if (crimeTypeValue == "ALL") { return "Crimes"; } else { return crimeTypeValue} }).

    			attr("x", lineGraphHeight / 2).

				attr("y", lineGraphHeight / 2).

  				style("text-anchor", "middle").

  				style("font-size", "16px").

  				style("fill", "red").

  				attr("dy", 30).

  				attr("dx", 10);



    totalCrimeGroup.append("svg:text").

    			text(function () { if (suburb == "ALL") { return "in Seattle"; } else { return "in "+suburb } }).
    			attr("x", lineGraphHeight / 2).
				attr("y", lineGraphHeight / 2).
  				style("text-anchor", "middle").
  				style("font-size", "16px").
  				// style("fill", "red").
  				attr("dy", 55).
  				attr("dx", 10);
    
    
	}
    
      
</script>



 </body>
</html>
